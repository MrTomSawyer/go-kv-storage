# Golang Key-Value Storage

Приложение представляет собой Key-Value-хранилище и набор методов для взаимодействия с ним. 

Хотя в самом задании требовалось реализовать только само хранилище, я все же сделал из этого целое gRPC-приложение. Это может показаться овер-инжинирингом, но выполнение задания так, как оно было описано, привело бы к реализации одной только структуры Storage без возможности взаимодействия с ней или проверки ее работы. Вторая причина - я обычно стараюсь выполнять тестовое задание так, чтобы в случае чего результат был пригоден для отправки на продакшен.

## Особенности
- Тип `Storage` описан в одноименном пакете и имеет 3 метода: `Get`, `Set` и `Delete`
- `Storage` потокобезопасен
- Под капотом используется `sync.Map`, как наиболее быстрое из доступных решений. Вариант с обычной мапой и мьютексом медленнее, так как `sync.Map` использует вместо локов атомарные операции.
- Каждое значение в хранилище представляет собой структуру вида:
```go
  type Entry struct {
      Value     string
      ExpiresAt time.Time
  }
```

- В пакете Storage также описана функция `CleanStorage`. Она запускается в отдельной горутине при старте приложения и периодически очищает хранилище от записей, срок валидности которых истек.
- `CleanStorage` имеет встроенную защиту на случай, если новая очистка пытается стартовать до того, как завершилась предыдущая.
- Storage имеет поле `DefaultTTL` - время жизни всех записей по умолчанию. Хотя метод Set позволяет задать каждой записи собственное время жизни.
- Приложение построено по классической трехслойной архитектуре.
- При проектировании применялись принципы SOLID.
- Storage покрыт тестами.
- Реализован `graceful shutdown`

## Что можно улучшить
- Добавить документацию.
- Добавить продвинутое логгирование.
- Тип `context.Context`, передаваемый в методы хранилища сейчас не используется за ненадобностью, хотя при расширении функционала хранилища ему найдется применение.
- В функции `CleanStorage` прослушиваются два канала - `ctx.Done()` и `тикер`. Так как порядок обработки не гарантирован, есть вероятность упустить сигнал из `ctx.Done()`. В этом месте в будущем нужно будет улучшить обработку событий. 

## Запуск приложения
- В корне приложения выполните `go run .\cmd\kv\main.go`. 
- Для конфигурации приложения при запуске существуют 3 необязательных флага: `port` - номер порта приложения, `ttl` - время жизни записей в хранилище по умолчанию, `cf` - частота запуска `CleanStorage`
- Для отправки запросов импортируйте .proto-файл из директории `proto/kv/kv.proto` в Postman.
- В директории `proto/gen/go` уже находятся сгенерированные gRPC-файлы, запуск `protoc` не требуется.
- Для запуска тестов в корне приложения выполните `go test ./...`